<!DOCTYPE html>

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="ge-round-img.html">
<link rel="import" href="ge-scholar-social-links.html">

<dom-module id="ge-scholar-profile">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
            :host {
                width: 100%;
                height: 100%;
                padding-bottom: 20px;
            }

            .body-section {
                float: left;
                position: relative;
                width: 100%;
                padding: 0;
                background-color: var(--app-color-white);
            }

            .story-section {
                min-height: 500px;
            }

            .story-section > h1 {
                position: relative;
                left: 5%;
                top: 20px;
                text-align: left;
                margin-bottom: 50px;
            }

            .blue-section {
                background-color: var(--app-color-blue);
            }

            .white-section {
                background-color: var(--app-color-white);
            }

            .blue-section a,
            .blue-section a,
            .blue-section h1,
            .blue-section p,
            .blue-section p,
            .blue-section span,
            .blue-section span {
                color: var(--app-color-white);
            }

            .white-section a,
            .white-section a,
            .white-section h1,
            .white-section p,
            .white-section p,
            .white-section span,
            .white-section span {
                color: var(--app-color-blue);
            }

            #profile-header {
                height: 40%;
            }

            #profile-header .header-item {
                font-size: 17px;
                margin: 5px;
                padding: 0;
            }

            #profile-header #social-links {
                position: absolute;
                left: 10px;
                top: 10px;
            }

            #profile-header #profile-picture {
                width: 200px;
                height: 200px;
                display: inline-block;
                margin-top: 25px;
            }

            #profile-header #scholar-name {
                font-size: 30px;
                margin-bottom: 10px;
                color: var(--app-color-white);
            }

        </style>

        <paper-material class="body-section blue-section" id="profile-header" layout vertical center elevation="[[elevation]]">
            <ge-round-img class="header-item" id="profile-picture" src="[[scholar.profilePicture]]" alt-src="[[_genericPersonImage(scholar.sex)]]"></ge-round-img>
            <ge-scholar-social-links id="social-links" scholar="[[scholar]]"></ge-scholar-social-links>
            <h1 class="header-item" id="scholar-name">[[scholar.fullName]]</h1>
            <a class="header-item" id="scholar-email" href="mailto:[[scholar.email]]">[[scholar.email]]</a>
            <p class="header-item">[[scholar.motto]]</p>
        </paper-material>
        <template is="dom-if" if="[[_shouldDisplayPersonal(scholar)]]">
            <paper-material class="body-section story-section white-section" id="personal-section" layout vertical left elevation="[[elevation]]">
                <h1>Personal information</h1>
                <!-- birthday: "12 December 1993",
                sex: "M",
                bornIn: "Deva, Romania",
                livesIn: "Timisoara, Romania",
                scholarSince: "2015",
                phone: "05616018919681", -->
            </paper-material>
        </template>
        <template is="dom-if" if="[[_shouldDisplayInterests(scholar)]]">
            <paper-material class="body-section story-section blue-section" id="interests-section" layout vertical left elevation="[[elevation]]">
                <h1>Interests</h1>
            </paper-material>
        </template>
        <template is="dom-if" if="[[_shouldDisplayProjects(scholar)]]">
            <paper-material class="body-section story-section white-section" id="projects-section" layout vertical left elevation="[[elevation]]">
                <h1>Projects</h1>
            </paper-material>
        </template>
        <template is="dom-if" if="[[_shouldDisplayEducation(scholar)]]">
            <paper-material class="body-section story-section blue-section" id="education-section" layout vertical left elevation="[[elevation]]">
                <h1>Education</h1>
            </paper-material>
        </template>
        <template is="dom-if" if="[[_shouldDisplayWorkExperience()]]">
            <paper-material class="body-section story-section white-section" id="work-section" layout vertical left elevation="[[elevation]]">
                <h1>Work experience</h1>
            </paper-material>
        </template>

    </template>

    <script src="../../bower_components/moment/moment.js"></script>
    <script>
        Polymer({
            is: 'ge-scholar-profile',

            properties: {
                scholar: {
                    type: Object,
                    observer: '_initializeScholar',
                },
                elevation: {
                    type: Number,
                    value: 0,
                },
            },

            _genericPersonImage: function (sex) {
                return displayModule.getGenericProfilePicture(sex);
            },

            _shouldDisplayPersonal(scholar) {
                return true;
            },

            _shouldDisplayInterests(scholar) {
                return true;
            },

            _shouldDisplayProjects(scholar) {
                return true;
            },

            _shouldDisplayEducation(scholar) {
                return true;
            },

            _shouldDisplayWorkExperience(scholar) {
                return true;
            },

            _initializeScholar: function() {
                if (validatorModule.isNull(this.scholar)) {
                    return;
                }

                this.set('scholar.age', this.computeAge());
                this.set('scholar.fullName', this.scholar.firstName + " " + this.scholar.lastName);

                if (!validatorModule.isNullOrEmpty(this.scholar.education)) {
                    this.set('scholar.education', this.scholar.education.sort(this.descDateComparer));
                }

                if (!validatorModule.isNullOrEmpty(this.scholar.work)) {
                    this.set('scholar.work', this.scholar.work.sort(this.descDateComparer));
                }
            },

            computeAge: function () {
                var birthDate = moment(this.scholar.birthday, "DD MMMM YYYY");
                var now = moment();

                return now.diff(birthDate, 'years');
            },

            descDateComparer: function (firstItem, secondItem) {
                if (validatorModule.isNull(firstItem.endDate)) {
                    if (validatorModule.isNull(secondItem.endDate)) {
                        var firstDate = moment(firstItem.startDate, "MMMM YYYY");
                        var secondDate = moment(secondItem.startDate, "MMMM YYYY");

                        return firstDate.diff(secondDate, "months");
                    }

                    return 1;
                } else if (validatorModule.isNull(secondItem.endDate)) {
                    if (validatorModule.isNull(firstItem.endDate)) {
                        var firstDate = moment(firstItem.startDate, "MMMM YYYY");
                        var secondDate = moment(secondItem.startDate, "MMMM YYYY");

                        return firstDate.diff(secondDate, "months");
                    }

                    return 1;
                }

                var firstDate = moment(firstItem.endDate, "MMMM YYYY");
                var secondDate = moment(secondItem.endDate, "MMMM YYYY");

                return firstDate.diff(secondDate, "months");
            },
        });
    </script>
</dom-module>
